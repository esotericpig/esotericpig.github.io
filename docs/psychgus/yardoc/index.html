<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  File: README
  
    &mdash; Psychgus v1.0.0 Doc
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "README";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


<link href="../../../css/prism.css" rel="stylesheet" /> </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index</a> &raquo; 
    <span class="title">File: README</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><div id='filecontents'><h1>Psychgus</h1>

<p>Psychgus uses the core standard library <a href="https://github.com/ruby/psych">Psych</a> for working with <a href="https://yaml.org">YAML</a> and extends it so that developers can easily style the YAML according to their needs.</p>

<p>Thank you to the people that worked and continue to work hard on the Psych project.</p>

<p>The Psychgus name comes from the well-styled character Gus from the TV show Psych.</p>

<h2>Contents</h2>

<ul>
<li><a href="#Setup">Setup</a></li>
<li><a href="#Using">Using</a>

<ul>
<li><a href="#Simple_Example">Simple Example</a></li>
<li><a href="#Hash_Example">Hash Example</a></li>
<li><a href="#Class_Example">Class Example</a></li>
<li><a href="#Advanced_Usage">Advanced Usage</a></li>
</ul></li>
<li><a href="#Hacking">Hacking</a>

<ul>
<li><a href="#Testing">Testing</a></li>
<li><a href="#Generating_Doc">Generating Doc</a></li>
</ul></li>
<li><a href="#License">License</a></li>
</ul>

<h2><a href="#Contents">Setup</a></h2>

<p>Pick your poison...</p>

<ul>
<li>With the RubyGems CLI package manager:

<ul>
<li><code>$ gem install psychgus</code></li>
</ul></li>
<li>In your <em>Gemspec</em> (<em>&lt;project&gt;.gemspec</em>):

<ul>
<li><code>spec.add_runtime_dependency &#39;psychgus&#39;,&#39;~&gt; x.x.x&#39;</code></li>
<li>Or, if you only need Psychgus in development (e.g., tests, rake, documentation):

<ul>
<li><code>spec.add_development_dependency &#39;psychgus&#39;,&#39;~&gt; x.x.x&#39;</code></li>
</ul></li>
</ul></li>
<li>In your <em>Gemfile</em>:

<ul>
<li><code>gem &#39;psychgus&#39;,&#39;~&gt; x.x.x&#39;</code></li>
<li>Or, with GitHub:

<ul>
<li><code>gem &#39;psychgus&#39;,:git=&gt;&#39;https://github.com/esotericpig/psychgus.git&#39;</code></li>
</ul></li>
</ul></li>
<li>Manually:

<ul>
<li><code>$ git clone &#39;https://github.com/esotericpig/psychgus.git&#39;</code></li>
<li><code>$ cd psychgus</code></li>
<li><code>$ bundle install</code></li>
<li><code>$ bundle exec rake install:local</code></li>
</ul></li>
</ul>

<h2><a href="#Contents">Using</a></h2>

<p>Documentation (YARDoc) is available on my <a href="https://esotericpig.github.io/docs/psychgus/yardoc/index.html">GitHub Page</a> and RubyDoc.info (<a href="https://www.rubydoc.info/gems/psychgus">[/gems]</a> or <a href="https://www.rubydoc.info/github/esotericpig/psychgus/master">[/github]</a>).</p>

<p>To begin styling, create a class and mix in (include) <code>Psychgus::Styler</code>. Then pass it in as a keyword arg (<code>stylers: MyStyler.new</code> or <code>stylers: [MyStyler1.new,MyStyler2.new]</code>) into one of the Psychgus methods.</p>

<p>For classes, you can optionally include <code>Psychgus::Blueberry</code> and return the styler(s) for the class by defining the <code>psychgus_stylers(sniffer)</code> method.</p>

<h3><a href="#Contents">Simple Example</a></h3>

<pre class="code Ruby"><code class="language-ruby">require &#39;psychgus&#39;

class CoffeeStyler
  include Psychgus::Styler

  def style_sequence(sniffer,node)
    node.style = Psychgus::SEQUENCE_FLOW
  end
end

coffee = {
  &#39;Roast&#39;=&gt;[&#39;Light&#39;, &#39;Medium&#39;, &#39;Dark&#39;, &#39;Extra Dark&#39;],
  &#39;Style&#39;=&gt;[&#39;Cappuccino&#39;, &#39;Espresso&#39;, &#39;Latte&#39;, &#39;Mocha&#39;]
}

puts coffee.to_yaml(stylers: CoffeeStyler.new)

# Output:
# ---
# Roast: [Light, Medium, Dark, Extra Dark]
# Style: [Cappuccino, Espresso, Latte, Mocha]

class Coffee
  include Psychgus::Blueberry

  def initialize
    @roast = [&#39;Light&#39;, &#39;Medium&#39;, &#39;Dark&#39;, &#39;Extra Dark&#39;]
    @style = [&#39;Cappuccino&#39;, &#39;Espresso&#39;, &#39;Latte&#39;, &#39;Mocha&#39;]
  end

  def psychgus_stylers(sniffer)
    CoffeeStyler.new
  end
end

puts Coffee.new.to_yaml

# Output:
# --- !ruby/object:Coffee
# roast: [Light, Medium, Dark, Extra Dark]
# style: [Cappuccino, Espresso, Latte, Mocha]
</code></pre>

<h3><a href="#Contents">Hash Example</a></h3>

<pre class="code Ruby"><code class="language-ruby">require &#39;psychgus&#39;

class BurgerStyler
  include Psychgus::Styler # Mix in methods needed for styling

  # Style maps (Psych::Nodes::Mapping)
  # - Hashes (key/value pairs)
  # - Example: &quot;Burgers: Classic {}&quot;
  def style_mapping(sniffer,node)
    node.style = Psychgus::MAPPING_FLOW if sniffer.level &gt;= 4
  end

  # Style scalars (Psych::Nodes::Scalar)
  # - Any text (non-alias)
  def style_scalar(sniffer,node)
    # Remove colon (change symbols into strings)
    node.value = node.value.sub(&#39;:&#39;,&#39;&#39;)

    # Capitalize each word
    node.value = node.value.split(&#39; &#39;).map do |v|
      if v.casecmp(&#39;BBQ&#39;) == 0
        v.upcase()
      else
        v.capitalize()
      end
    end.join(&#39; &#39;)

    # Change lettuce to spinach
    node.value = &#39;Spinach&#39; if node.value == &#39;Lettuce&#39;
  end

  # Style sequences (Psych::Nodes::Sequence)
  # - Arrays
  # - Example: &quot;[Lettuce, Onions, Pickles, Tomatoes]&quot;
  def style_sequence(sniffer,node)
    node.style = Psychgus::SEQUENCE_FLOW if sniffer.level &gt;= 4
  end
end

burgers = {
  :burgers =&gt; {
    :classic =&gt; {:sauce  =&gt; %w(Ketchup Mustard),
                 :cheese =&gt; &#39;American&#39;,
                 :bun    =&gt; &#39;Sesame Seed&#39;},
    :bbq     =&gt; {:sauce  =&gt; &#39;Honey BBQ&#39;,
                 :cheese =&gt; &#39;Cheddar&#39;,
                 :bun    =&gt; &#39;Kaiser&#39;},
    :fancy   =&gt; {:sauce  =&gt; &#39;Spicy Wasabi&#39;,
                 :cheese =&gt; &#39;Smoked Gouda&#39;,
                 :bun    =&gt; &#39;Hawaiian&#39;}
  },
  :toppings =&gt; [
    &#39;Mushrooms&#39;,
    %w(Lettuce Onions Pickles Tomatoes),
    [%w(Ketchup Mustard), %w(Salt Pepper)]
  ]
}
burgers[:favorite] = burgers[:burgers][:bbq] # Alias

puts burgers.to_yaml(indent: 3,stylers: BurgerStyler.new)

# Output:
# ---
# Burgers:
#    Classic: {Sauce: [Ketchup, Mustard], Cheese: American, Bun: Sesame Seed}
#    BBQ: &amp;1 {Sauce: Honey BBQ, Cheese: Cheddar, Bun: Kaiser}
#    Fancy: {Sauce: Spicy Wasabi, Cheese: Smoked Gouda, Bun: Hawaiian}
# Toppings:
# - Mushrooms
# - [Spinach, Onions, Pickles, Tomatoes]
# - [[Ketchup, Mustard], [Salt, Pepper]]
# Favorite: *1

# Or pass in a Hash. Can also dereference aliases.
puts burgers.to_yaml({:indent =&gt; 3,:stylers =&gt; BurgerStyler.new,:deref_aliases =&gt; true})

# Output:
# ---
# Burgers:
#    Classic: {Sauce: [Ketchup, Mustard], Cheese: American, Bun: Sesame Seed}
#    BBQ: {Sauce: Honey BBQ, Cheese: Cheddar, Bun: Kaiser}
#    Fancy: {Sauce: Spicy Wasabi, Cheese: Smoked Gouda, Bun: Hawaiian}
# Toppings:
# - Mushrooms
# - [Spinach, Onions, Pickles, Tomatoes]
# - [[Ketchup, Mustard], [Salt, Pepper]]
# Favorite:
#    Sauce: Honey BBQ
#    Cheese: Cheddar
#    Bun: Kaiser
</code></pre>

<h3><a href="#Contents">Class Example</a></h3>

<pre class="code Ruby"><code class="language-ruby">require &#39;psychgus&#39;

class BurgerStyler
  include Psychgus::Styler # Mix in methods needed for styling

  def initialize(sniffer)
    @class_level    = sniffer.level
    @class_position = sniffer.position
  end

  # Style all nodes (Psych::Nodes::Node)
  def style(sniffer,node)
    # Remove &quot;!ruby/object:...&quot; for Burger classes (not Burgers class)
    node.tag = nil if node.node_of?(:mapping,:scalar,:sequence)

    # This is another way to do the above
    #node.tag = nil if node.respond_to?(:tag=)
  end

  # Style maps (Psych::Nodes::Mapping)
  # - Hashes (key/value pairs)
  # - Example: &quot;Burgers: Classic {}&quot;
  def style_mapping(sniffer,node)
    parent = sniffer.parent

    if !parent.nil?()
      # BBQ
      node.style = Psychgus::MAPPING_FLOW if parent.node_of?(:scalar) &amp;&amp;
                                             parent.value.casecmp(&#39;BBQ&#39;) == 0
    end
  end

  # Style scalars (Psych::Nodes::Scalar)
  # - Any text (non-alias)
  def style_scalar(sniffer,node)
    parent = sniffer.parent

    # Single quote scalars that are not keys to a map
    node.style = Psychgus::SCALAR_SINGLE_QUOTED if !parent.nil?() &amp;&amp;
                                                   parent.child_type != :key
  end

  # Style sequences (Psych::Nodes::Sequence)
  # - Arrays
  # - Example: &quot;[Lettuce, Onions, Pickles, Tomatoes]&quot;
  def style_sequence(sniffer,node)
    relative_level = (sniffer.level - @class_level) + 1

    # &quot;[Ketchup, Mustard]&quot;
    node.style = Psychgus::SEQUENCE_FLOW if relative_level == 3
  end
end

class Burger
  include Psychgus::Blueberry # Mix in methods needed to be stylable

  attr_accessor :bun
  attr_accessor :cheese
  attr_accessor :sauce

  def initialize(sauce,cheese,bun)
    @bun    = bun
    @cheese = cheese
    @sauce  = sauce
  end

  # Return our styler(s)
  # - Can be an Array: [MyStyler1.new, MyStyler2.new]
  def psychgus_stylers(sniffer)
    return BurgerStyler.new(sniffer)
  end

  # You can still use Psych&#39;s encode_with(), no problem
  def encode_with(coder)
    coder[&#39;Bun&#39;]    = @bun
    coder[&#39;Cheese&#39;] = @cheese
    coder[&#39;Sauce&#39;]  = @sauce
  end
end

class Burgers
  attr_accessor :burgers
  attr_accessor :toppings
  attr_accessor :favorite

  def initialize()
    @burgers = {
      &#39;Classic&#39; =&gt; Burger.new([&#39;Ketchup&#39;,&#39;Mustard&#39;],&#39;American&#39;    ,&#39;Sesame Seed&#39;),
      &#39;BBQ&#39;     =&gt; Burger.new(&#39;Honey BBQ&#39;          ,&#39;Cheddar&#39;     ,&#39;Kaiser&#39;),
      &#39;Fancy&#39;   =&gt; Burger.new(&#39;Spicy Wasabi&#39;       ,&#39;Smoked Gouda&#39;,&#39;Hawaiian&#39;)
    }

    @toppings = [
      &#39;Mushrooms&#39;,
      %w(Lettuce Onions Pickles Tomatoes),
      [%w(Ketchup Mustard),%w(Salt Pepper)]
    ]

    @favorite = @burgers[&#39;BBQ&#39;] # Alias
  end

  # You can still use Psych&#39;s encode_with(), no problem
  def encode_with(coder)
    coder[&#39;Burgers&#39;]  = @burgers
    coder[&#39;Toppings&#39;] = @toppings
    coder[&#39;Favorite&#39;] = @favorite
  end
end

burgers = Burgers.new

puts burgers.to_yaml(indent: 3)

# Output:
# --- !ruby/object:Burgers
# Burgers:
#    Classic:
#       Bun: &#39;Sesame Seed&#39;
#       Cheese: &#39;American&#39;
#       Sauce: [&#39;Ketchup&#39;, &#39;Mustard&#39;]
#    BBQ: &amp;1 {Bun: &#39;Kaiser&#39;, Cheese: &#39;Cheddar&#39;, Sauce: &#39;Honey BBQ&#39;}
#    Fancy:
#       Bun: &#39;Hawaiian&#39;
#       Cheese: &#39;Smoked Gouda&#39;
#       Sauce: &#39;Spicy Wasabi&#39;
# Toppings:
# - Mushrooms
# -  - Lettuce
#    - Onions
#    - Pickles
#    - Tomatoes
# -  -  - Ketchup
#       - Mustard
#    -  - Salt
#       - Pepper
# Favorite: *1

# Or pass in a Hash. Can also dereference aliases.
puts burgers.to_yaml({:indent =&gt; 3,:deref_aliases =&gt; true})

# Output:
# --- !ruby/object:Burgers
# Burgers:
#    Classic:
#       Bun: &#39;Sesame Seed&#39;
#       Cheese: &#39;American&#39;
#       Sauce: [&#39;Ketchup&#39;, &#39;Mustard&#39;]
#    BBQ: {Bun: &#39;Kaiser&#39;, Cheese: &#39;Cheddar&#39;, Sauce: &#39;Honey BBQ&#39;}
#    Fancy:
#       Bun: &#39;Hawaiian&#39;
#       Cheese: &#39;Smoked Gouda&#39;
#       Sauce: &#39;Spicy Wasabi&#39;
# Toppings:
# - Mushrooms
# -  - Lettuce
#    - Onions
#    - Pickles
#    - Tomatoes
# -  -  - Ketchup
#       - Mustard
#    -  - Salt
#       - Pepper
# Favorite:
#    Bun: &#39;Kaiser&#39;
#    Cheese: &#39;Cheddar&#39;
#    Sauce: &#39;Honey BBQ&#39;
</code></pre>

<h3><a href="#Contents">Advanced Usage</a></h3>

<pre class="code Ruby"><code class="language-ruby">require &#39;psychgus&#39;

class MyStyler
  include Psychgus::Styler

  def style_sequence(sniffer,node)
    node.style = Psychgus::SEQUENCE_FLOW
  end
end

coffee = {
  &#39;Coffee&#39; =&gt; {
    &#39;Roast&#39;=&gt;[&#39;Light&#39;, &#39;Medium&#39;, &#39;Dark&#39;, &#39;Extra Dark&#39;],
    &#39;Style&#39;=&gt;[&#39;Cappuccino&#39;, &#39;Espresso&#39;, &#39;Latte&#39;, &#39;Mocha&#39;]
  }
}
eggs = {
  &#39;Eggs&#39; =&gt; {
    &#39;Color&#39;=&gt;[&#39;Brown&#39;, &#39;White&#39;, &#39;Blue&#39;, &#39;Olive&#39;],
    &#39;Style&#39;=&gt;[&#39;Fried&#39;, &#39;Scrambled&#39;, &#39;Omelette&#39;, &#39;Poached&#39;]
  }
}

filename = &#39;coffee-and-eggs.yaml&#39;
styler = MyStyler.new
options = {:indentation=&gt;3, :stylers=&gt;styler, :deref_aliases=&gt;true}

coffee_yaml = coffee.to_yaml(options)
coffee_and_eggs_yaml = Psychgus.dump_stream(coffee,eggs,options)


# High-level emitting
puts Psychgus.dump(coffee,options)
puts

Psychgus.dump_file(filename,coffee,eggs,options)
puts File.readlines(filename)
puts

puts Psychgus.dump_stream(coffee,eggs,options)
puts

puts coffee.to_yaml(options)
puts

# High-level parsing
# - Because to_ruby() will be called, just use Psych:
#   - load(), load_file(), load_stream(), safe_load()

# Mid-level emitting
stream = Psychgus.parse_stream(coffee_and_eggs_yaml,options)

puts stream.to_yaml()
puts

# Mid-level parsing
puts Psychgus.parse(coffee_yaml,options).to_ruby
puts

puts Psychgus.parse_file(filename,options).to_ruby
puts

i = 0
Psychgus.parse_stream(coffee_and_eggs_yaml,options) do |doc|
  puts &quot;Doc ##{i += 1}:&quot;
  puts &quot;  #{doc.to_ruby}&quot;
end
puts

# Low-level emitting
tree_builder = Psychgus::StyledTreeBuilder.new(styler,options)
visitor = Psych::Visitors::YAMLTree.create(options,tree_builder)

visitor &lt;&lt; coffee
visitor &lt;&lt; eggs

puts visitor.tree.to_yaml
puts

# Low-level parsing
parser = Psychgus.parser(options)

parser.parse(coffee_yaml)

puts parser.handler.root.to_ruby
puts
</code></pre>

<h2><a href="#Contents">Hacking</a></h2>

<pre class="code ruby"><code class="ruby">$ git clone &#39;https://github.com/esotericpig/psychgus.git&#39;
$ bundle install
$ bundle exec rake -T
</code></pre>

<h3><a href="#Contents">Testing</a></h3>

<p>Run tests, excluding tests that create temp files:</p>

<p><code>$ bundle exec rake test</code></p>

<p>Run all tests:</p>

<p><code>$ bundle exec rake test_all</code></p>

<h3><a href="#Contents">Generating Doc</a></h3>

<p>Generate basic doc:</p>

<p><code>$ bundle exec rake yard</code></p>

<p>Fix GitHub-specific differences:</p>

<p><code>$ bundle exec rake yard_fix</code></p>

<p>Clean doc &amp; run all of the above:</p>

<p><code>$ bundle exec rake yard_fresh</code></p>

<p>Deploy doc to my GitHub Page (not useful for others):</p>

<p><code>$ bundle exec rake ghp_doc</code></p>

<h2><a href="#Contents">License</a></h2>

<p><a href="file.LICENSE.html">GNU LGPL v3+</a></p>

<blockquote>
<p>Psychgus (<a href="https://github.com/esotericpig/psychgus">https://github.com/esotericpig/psychgus</a>)<br>
Copyright (c) 2017-2019 Jonathan Bradley Whited (@esotericpig)  </p>

<p>Psychgus is free software: you can redistribute it and/or modify<br>
it under the terms of the GNU Lesser General Public License as published by<br>
the Free Software Foundation, either version 3 of the License, or<br>
(at your option) any later version.  </p>

<p>Psychgus is distributed in the hope that it will be useful,<br>
but WITHOUT ANY WARRANTY; without even the implied warranty of<br>
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the<br>
GNU Lesser General Public License for more details.  </p>

<p>You should have received a copy of the GNU Lesser General Public License<br>
along with Psychgus.  If not, see <a href="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</a>.  </p>
</blockquote>
</div></div>

      
<div id="footer">
  Generated by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>.
</div>

    </div>
<script src="../../../js/prism.js"></script> </body>
</html>
